<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YSU SensorTag v1: New Sensor Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">YSU SensorTag v1
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_readmes_new_sensor_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">New Sensor Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This guide will walk you through creating a new sensor on the YSU platform. This guide will cover the software/firmware development. This will not walk through the development of any physical hardware.</p>
<p >Please consult the main YSU SensorTag README to ensure you have all prerequisites.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Developing For a New Board</h1>
<p >If the device being written for is a new PCB design, there is some additional work that must be done before moving into Code Composer Studio. Firstly, a new folder should be created for your device in <code>&lt;path-to-ble-sdk&gt;/examples/</code>. This is where you will put any projects you develop. Additionally, a new folder will need to be placed in <code>&lt;path-to-ble-sdk&gt;/src/boards/</code>. This is where all of your board specific configurations should go. Look at other devices for reference. A final folder should be added in <code>&lt;path-to-ble-sdk&gt;/src/target/</code>. This will contain routing information for your board. Again, look at other devices for reference. While in the <code>target</code> folder, open <code>board.h</code> and <code>board.c</code> and add support for your board. DO NOT REMOVE ANYTHING.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Creating a Project</h1>
<p >Go to <code>ti/simplelink/&lt;ble-sdk&gt;/examples</code> and find the folder for your device. If it does not exist, go to <code>Developing For a New Board</code> above. Choose the closest example as a staring point for your project and copy the entire folder. Do not edit in place or cut. Paste it in your device's folder and name it to your project name.</p>
<p >Go to Code Composer Studio and open the workspace you would like the project to be in. Select <code>File -&gt; Import</code>. Select &lsquo;'CCS Project&rsquo;<code>and browse to where the project you'd like to edit is located. Select the whole project folder. There should be a checkbox showing both an</code>app<code>and</code>stack` project able to import. Select each of these and continue.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Adding a Sensor</h1>
<h3><a class="anchor" id="autotoc_md12"></a>
File Setup</h3>
<p >After getting your project set up, you can now add support for a new sensor. The first step is to create a folder for your sensor. In this folder I like to have two sub folders, one for direct interaction with the sensor say &lsquo;'sensor_driver&rsquo;` and one for BLE.</p>
<div class="fragment"><div class="line">├── &lt;sensorname&gt;</div>
<div class="line">│   ├── ble</div>
<div class="line">│   │   ├── &lt;sensorname&gt;_service.h</div>
<div class="line">│   │   ├── &lt;sensorname&gt;_service.c</div>
<div class="line">│   ├── sensor_driver</div>
<div class="line">│   │   ├── &lt;sensorname&gt;_driver.h</div>
<div class="line">│   │   ├── &lt;sensorname&gt;_driver.c</div>
<div class="line">│   ├── &lt;sensorname&gt;.h</div>
<div class="line">│   ├── &lt;sensorname&gt;.c</div>
<div class="line">│</div>
<div class="line">...</div>
</div><!-- fragment --><p> This is just an example, it is not required for your sensor to work but can help keep things organized. Once the file structure is set up, you can begin programming for the sensor.</p>
<p >Note: There are two main options when deciding how to program the sensor. You can define a new task for the sensor which will allow it to handle its own timing and state, or it can be polled from the main task. This makes more sense if the sensor reports on the system as a whole, say a battery state service. For sensors measuring outside variables, I would recommend creating a task. This guide will focus on creating a sensor with its own RTOS task but I will mention where a main thread sensor would be different.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
File Contents</h3>
<p >The <code>&lt;sensorname&gt;.h</code> file will contain declarations to four functions. </p><div class="fragment"><div class="line">extern void &lt;sensorname&gt;_createTask(void);</div>
<div class="line">extern void &lt;sensorname&gt;_init(void);</div>
<div class="line">extern void &lt;sensorname&gt;_processCharChangeEvt(uint8_t paramID);</div>
<div class="line">extern void &lt;sensorname&gt;_reset(void);</div>
</div><!-- fragment --><p> If your sensor does not use a task,<code>&lt;sensorname&gt;_createTask</code> would be omitted. You can see an example of this in the <code>SENSOR_EXAMPLE</code> folder included in the repo.</p>
<p ><code>&lt;sensorname&gt;.c</code> should contain the implementations to these functions as well as some other local functions. This can also be see in the <code>SENSOR_EXAMPLE</code> folder.</p>
<p >The <code>sensor_driver</code> folder will contain device specific implementation. The only thing that must be included is a function to read the device. This should be declared in the 'h' file so that it can be see by the task.</p>
<p >The <code>ble</code> folder will contain everything about the BLE service pertaining to your sensor. There will be an example of this in the <code>SENSOR_EXAMPLE</code> folder.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Common Fixes</h1>
<p >If your project builds but does not seem to be operating correctly, you may be running out of space in your task stack. You can either increase this or edit your code to be a little more memory efficient. This would mean removing any unnecessary local variables, and may mean converting them to static globals so they are not stored in the stack.</p>
<p >Alternatively, try increasing <code>ICALL_MAX_NUM_ENTITIES</code> &amp; <code>ICALL_MAX_NUM_TASKS</code> by right clicking on the project, going to <code>Properties -&gt; Build -&gt; ARM Compiler -&gt; Advanced Options -&gt; Predefined Symbols</code>.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Known Issues</h1>
<p >This section will be updated with time. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
