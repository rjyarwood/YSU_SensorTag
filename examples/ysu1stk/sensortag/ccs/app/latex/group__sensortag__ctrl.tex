\hypertarget{group__sensortag__ctrl}{}\doxysection{Sensor\+Tag Control}
\label{group__sensortag__ctrl}\index{SensorTag Control@{SensorTag Control}}


Functions to control the flow of the software and hardware of the Sensor\+Tag.  


\doxysubsection*{Modules}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{group__service__ids}{Service IDs}}
\begin{DoxyCompactList}\small\item\em Service ID\textquotesingle{}s for internal application use. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structst_evt__t}{st\+Evt\+\_\+t}}
\begin{DoxyCompactList}\small\item\em App event passed from profiles. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga2a07efb2523275f6e61b77d2f1034a78}\label{group__sensortag__ctrl_ga2a07efb2523275f6e61b77d2f1034a78}} 
\#define {\bfseries ST\+\_\+\+PERIODIC\+\_\+\+EVT\+\_\+\+PERIOD}~1000
\begin{DoxyCompactList}\small\item\em How often to perform periodic event (in milliseconds) \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga20f40bdf82cc42c714b937b1e739390f}\label{group__sensortag__ctrl_ga20f40bdf82cc42c714b937b1e739390f}} 
\#define {\bfseries ST\+\_\+\+DEVICE\+\_\+\+ID}~0x03
\begin{DoxyCompactList}\small\item\em ID of Sensor\+Tag device. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga123e665a946cbf83613d492838c700d0}\label{group__sensortag__ctrl_ga123e665a946cbf83613d492838c700d0}} 
\#define {\bfseries ST\+\_\+\+KEY\+\_\+\+DATA\+\_\+\+ID}~0x00
\item 
\mbox{\Hypertarget{group__sensortag__ctrl_gaaa0f78ed174d212fb0e4d4a903dcf4e2}\label{group__sensortag__ctrl_gaaa0f78ed174d212fb0e4d4a903dcf4e2}} 
\#define {\bfseries B\+\_\+\+ADDR\+\_\+\+STR\+\_\+\+LEN}~15
\begin{DoxyCompactList}\small\item\em Length of board address. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga3f09a28e0fdb334ff1d37a3f5dc248f8}\label{group__sensortag__ctrl_ga3f09a28e0fdb334ff1d37a3f5dc248f8}} 
\#define {\bfseries ST\+\_\+\+TASK\+\_\+\+PRIORITY}~1
\begin{DoxyCompactList}\small\item\em Task configuration. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga5979db39a4841bdc3b9d98c98b5609c0}\label{group__sensortag__ctrl_ga5979db39a4841bdc3b9d98c98b5609c0}} 
\#define {\bfseries ST\+\_\+\+TASK\+\_\+\+STACK\+\_\+\+SIZE}~1024
\begin{DoxyCompactList}\small\item\em Stack size may be overridden by project settings. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga5aab9239f883ad8058f513aad7414b66}\label{group__sensortag__ctrl_ga5aab9239f883ad8058f513aad7414b66}} 
\#define {\bfseries ST\+\_\+\+STATE\+\_\+\+CHANGE\+\_\+\+EVT}~0x0001
\begin{DoxyCompactList}\small\item\em Mask for an RTOS state event. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_gaa31c9cb09ca1f8cb52990ae00bbf5ae8}\label{group__sensortag__ctrl_gaa31c9cb09ca1f8cb52990ae00bbf5ae8}} 
\#define {\bfseries ST\+\_\+\+CHAR\+\_\+\+CHANGE\+\_\+\+EVT}~0x0002
\begin{DoxyCompactList}\small\item\em Mask for a BLE Characteristic event. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga3906c76a2b535cbbc495cbb3f9034a02}\label{group__sensortag__ctrl_ga3906c76a2b535cbbc495cbb3f9034a02}} 
\#define {\bfseries ST\+\_\+\+PERIODIC\+\_\+\+EVT}~0x0004
\begin{DoxyCompactList}\small\item\em Mask for a Periodic event. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga5f48eb0ae0217d21dc4903ee025ca0ca}\label{group__sensortag__ctrl_ga5f48eb0ae0217d21dc4903ee025ca0ca}} 
\#define {\bfseries SBP\+\_\+\+OAD\+\_\+\+WRITE\+\_\+\+EVT}~0x0008
\begin{DoxyCompactList}\small\item\em Mask for an OAD write event. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_gad4957cb1be5c3ce6d4d11f836676c2b2}\label{group__sensortag__ctrl_gad4957cb1be5c3ce6d4d11f836676c2b2}} 
\#define {\bfseries INVALID\+\_\+\+CONNHANDLE}~0x\+FFFF
\begin{DoxyCompactList}\small\item\em Misc. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga49ddd8e346870425eea945539929cd0b}\label{group__sensortag__ctrl_ga49ddd8e346870425eea945539929cd0b}} 
\#define {\bfseries TEST\+\_\+\+INDICATION\+\_\+\+BLINKS}~5
\item 
\mbox{\Hypertarget{group__sensortag__ctrl_gac0eef287f0b91215b4465d6e711e01c3}\label{group__sensortag__ctrl_gac0eef287f0b91215b4465d6e711e01c3}} 
\#define {\bfseries OAD\+\_\+\+PACKET\+\_\+\+SIZE}~18
\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga9513b6bde4597b1f4e7caef998122a03}\label{group__sensortag__ctrl_ga9513b6bde4597b1f4e7caef998122a03}} 
\#define {\bfseries KEY\+\_\+\+STATE\+\_\+\+OFFSET}~13
\item 
\mbox{\Hypertarget{group__sensortag__ctrl_gab9f15748d05c7c76b040b4845d29c517}\label{group__sensortag__ctrl_gab9f15748d05c7c76b040b4845d29c517}} 
\#define {\bfseries YSU\+\_\+\+COMPANY\+\_\+\+ID}~0x0\+FFA
\begin{DoxyCompactList}\small\item\em Maybe change this but it should be universal for all things developed with this code so don\textquotesingle{}t just change for your project. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{group__sensortag__ctrl_ga50b43f4a4fda661dcd44482e9c1a234c}{Sensor\+Tag\+\_\+create\+Task}} (void)
\begin{DoxyCompactList}\small\item\em Creates the main task for the YSU Sensor\+Tag. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{group__sensortag__ctrl_ga2f6fd326eb97aef2e3c414bc20b7cb61}{Sensor\+Tag\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Initializes the Sensor\+Tag and its BLE configurations. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{group__sensortag__ctrl_gac9e9c40cd9c1e8d56a2825bc20291ceb}{Sensor\+Tag\+\_\+task\+Fxn}} (UArg a0, UArg a1)
\begin{DoxyCompactList}\small\item\em Main application thread. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{group__sensortag__ctrl_ga241534fd653e204565880b6d768ae9ec}{Sensor\+Tag\+\_\+clock\+Handler}} (UArg arg)
\begin{DoxyCompactList}\small\item\em Handler function for clock time-\/outs. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{group__sensortag__ctrl_ga9158d7d5d4e6d6832895ea8c1868af6a}{Sensor\+Tag\+\_\+reset\+All\+Modules}} (void)
\begin{DoxyCompactList}\small\item\em Reset all modules, typically when a connection is terminated. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{group__sensortag__ctrl_ga7ce64fe3d0805204d263fca045d3c6f6}{Sensor\+Tag\+\_\+callback}} (PIN\+\_\+\+Handle handle, PIN\+\_\+\+Id pin\+Id)
\begin{DoxyCompactList}\small\item\em If you are going to add hwi callbacks, do it here. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{group__sensortag__ctrl_ga4e4160ff3c12d89b6d8a79cbbbce8909}{Sensor\+Tag\+\_\+process\+App\+Msg}} (\mbox{\hyperlink{structst_evt__t}{st\+Evt\+\_\+t}} $\ast$p\+Msg)
\begin{DoxyCompactList}\small\item\em Process an incoming callback from a profile. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga1e42536f2fb05a5ef14f403b45ec8942}\label{group__sensortag__ctrl_ga1e42536f2fb05a5ef14f403b45ec8942}} 
PIN\+\_\+\+State {\bfseries pin\+Gpio\+State}
\begin{DoxyCompactList}\small\item\em Global pin resources. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_gaaac114d1a5e7723d1c509caa8d453c2c}\label{group__sensortag__ctrl_gaaac114d1a5e7723d1c509caa8d453c2c}} 
PIN\+\_\+\+Handle {\bfseries h\+Gpio\+Pin}
\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga8f8709c3156aaec4fafdd92a204eecf0}\label{group__sensortag__ctrl_ga8f8709c3156aaec4fafdd92a204eecf0}} 
static Task\+\_\+\+Struct {\bfseries sensor\+Tag\+Task}
\begin{DoxyCompactList}\small\item\em Task configuration. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_gae440a441a0ea07ecb203f52108ccfb06}\label{group__sensortag__ctrl_gae440a441a0ea07ecb203f52108ccfb06}} 
static Char {\bfseries sensor\+Tag\+Task\+Stack} \mbox{[}\mbox{\hyperlink{group__sensortag__ctrl_ga5979db39a4841bdc3b9d98c98b5609c0}{ST\+\_\+\+TASK\+\_\+\+STACK\+\_\+\+SIZE}}\mbox{]}
\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga1d24e15553a5efaa1c6cb136e8c92580}\label{group__sensortag__ctrl_ga1d24e15553a5efaa1c6cb136e8c92580}} 
static Clock\+\_\+\+Struct {\bfseries periodic\+Clock}
\begin{DoxyCompactList}\small\item\em Clock instances for internal periodic events. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga24095f45f00638b7707c6feb2f77c6b5}\label{group__sensortag__ctrl_ga24095f45f00638b7707c6feb2f77c6b5}} 
static Queue\+\_\+\+Struct {\bfseries app\+Msg}
\begin{DoxyCompactList}\small\item\em Queue object used for app messages. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga8b541ea22fa84a7a5d6c3b48c41360a9}\label{group__sensortag__ctrl_ga8b541ea22fa84a7a5d6c3b48c41360a9}} 
static Queue\+\_\+\+Handle {\bfseries app\+Msg\+Queue}
\item 
\mbox{\Hypertarget{group__sensortag__ctrl_ga6eba7182f2d70031a4f6ba3a2fc8d569}\label{group__sensortag__ctrl_ga6eba7182f2d70031a4f6ba3a2fc8d569}} 
static uint16\+\_\+t {\bfseries events}
\begin{DoxyCompactList}\small\item\em events flag for internal application events. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Functions to control the flow of the software and hardware of the Sensor\+Tag. 



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{group__sensortag__ctrl_ga7ce64fe3d0805204d263fca045d3c6f6}\label{group__sensortag__ctrl_ga7ce64fe3d0805204d263fca045d3c6f6}} 
\index{SensorTag Control@{SensorTag Control}!SensorTag\_callback@{SensorTag\_callback}}
\index{SensorTag\_callback@{SensorTag\_callback}!SensorTag Control@{SensorTag Control}}
\doxysubsubsection{\texorpdfstring{SensorTag\_callback()}{SensorTag\_callback()}}
{\footnotesize\ttfamily static void Sensor\+Tag\+\_\+callback (\begin{DoxyParamCaption}\item[{PIN\+\_\+\+Handle}]{handle,  }\item[{PIN\+\_\+\+Id}]{pin\+Id }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



If you are going to add hwi callbacks, do it here. 


\begin{DoxyParams}{Parameters}
{\em handle} & \\
\hline
{\em pin\+Id} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\mbox{\Hypertarget{group__sensortag__ctrl_ga241534fd653e204565880b6d768ae9ec}\label{group__sensortag__ctrl_ga241534fd653e204565880b6d768ae9ec}} 
\index{SensorTag Control@{SensorTag Control}!SensorTag\_clockHandler@{SensorTag\_clockHandler}}
\index{SensorTag\_clockHandler@{SensorTag\_clockHandler}!SensorTag Control@{SensorTag Control}}
\doxysubsubsection{\texorpdfstring{SensorTag\_clockHandler()}{SensorTag\_clockHandler()}}
{\footnotesize\ttfamily static void Sensor\+Tag\+\_\+clock\+Handler (\begin{DoxyParamCaption}\item[{UArg}]{arg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Handler function for clock time-\/outs. 


\begin{DoxyParams}{Parameters}
{\em arg} & -\/ event type\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\mbox{\Hypertarget{group__sensortag__ctrl_ga50b43f4a4fda661dcd44482e9c1a234c}\label{group__sensortag__ctrl_ga50b43f4a4fda661dcd44482e9c1a234c}} 
\index{SensorTag Control@{SensorTag Control}!SensorTag\_createTask@{SensorTag\_createTask}}
\index{SensorTag\_createTask@{SensorTag\_createTask}!SensorTag Control@{SensorTag Control}}
\doxysubsubsection{\texorpdfstring{SensorTag\_createTask()}{SensorTag\_createTask()}}
{\footnotesize\ttfamily void Sensor\+Tag\+\_\+create\+Task (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Creates the main task for the YSU Sensor\+Tag. 


\begin{DoxyParams}{Parameters}
{\em none} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none
\end{DoxyReturn}
This function sets up the Sensor\+Tag Task and registers it with the TIRTOS Kernel \mbox{\Hypertarget{group__sensortag__ctrl_ga2f6fd326eb97aef2e3c414bc20b7cb61}\label{group__sensortag__ctrl_ga2f6fd326eb97aef2e3c414bc20b7cb61}} 
\index{SensorTag Control@{SensorTag Control}!SensorTag\_init@{SensorTag\_init}}
\index{SensorTag\_init@{SensorTag\_init}!SensorTag Control@{SensorTag Control}}
\doxysubsubsection{\texorpdfstring{SensorTag\_init()}{SensorTag\_init()}}
{\footnotesize\ttfamily static void Sensor\+Tag\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Initializes the Sensor\+Tag and its BLE configurations. 


\begin{DoxyParams}{Parameters}
{\em none} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none
\end{DoxyReturn}
This function initializes BLE and any board drivers. This includes registering the entire app with the ICALL dispatcher, creating a message queue for RTOS messages. It also initializes a clock for periodic events and initializes the GAP and GATT. This is where you call any functions that register services. TODO USER CODE 6\+: Initialize any board level drivers needed

TODO USER CODE 7\+: Call the function to set up your Bluetooth service\mbox{\Hypertarget{group__sensortag__ctrl_ga4e4160ff3c12d89b6d8a79cbbbce8909}\label{group__sensortag__ctrl_ga4e4160ff3c12d89b6d8a79cbbbce8909}} 
\index{SensorTag Control@{SensorTag Control}!SensorTag\_processAppMsg@{SensorTag\_processAppMsg}}
\index{SensorTag\_processAppMsg@{SensorTag\_processAppMsg}!SensorTag Control@{SensorTag Control}}
\doxysubsubsection{\texorpdfstring{SensorTag\_processAppMsg()}{SensorTag\_processAppMsg()}}
{\footnotesize\ttfamily static void Sensor\+Tag\+\_\+process\+App\+Msg (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structst_evt__t}{st\+Evt\+\_\+t}} $\ast$}]{p\+Msg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Process an incoming callback from a profile. 


\begin{DoxyParams}{Parameters}
{\em p\+Msg} & -\/ message to process\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\mbox{\Hypertarget{group__sensortag__ctrl_ga9158d7d5d4e6d6832895ea8c1868af6a}\label{group__sensortag__ctrl_ga9158d7d5d4e6d6832895ea8c1868af6a}} 
\index{SensorTag Control@{SensorTag Control}!SensorTag\_resetAllModules@{SensorTag\_resetAllModules}}
\index{SensorTag\_resetAllModules@{SensorTag\_resetAllModules}!SensorTag Control@{SensorTag Control}}
\doxysubsubsection{\texorpdfstring{SensorTag\_resetAllModules()}{SensorTag\_resetAllModules()}}
{\footnotesize\ttfamily static void Sensor\+Tag\+\_\+reset\+All\+Modules (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Reset all modules, typically when a connection is terminated. 


\begin{DoxyParams}{Parameters}
{\em none} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
If you are going to implement a reset this is where you would do it\mbox{\Hypertarget{group__sensortag__ctrl_gac9e9c40cd9c1e8d56a2825bc20291ceb}\label{group__sensortag__ctrl_gac9e9c40cd9c1e8d56a2825bc20291ceb}} 
\index{SensorTag Control@{SensorTag Control}!SensorTag\_taskFxn@{SensorTag\_taskFxn}}
\index{SensorTag\_taskFxn@{SensorTag\_taskFxn}!SensorTag Control@{SensorTag Control}}
\doxysubsubsection{\texorpdfstring{SensorTag\_taskFxn()}{SensorTag\_taskFxn()}}
{\footnotesize\ttfamily static void Sensor\+Tag\+\_\+task\+Fxn (\begin{DoxyParamCaption}\item[{UArg}]{a0,  }\item[{UArg}]{a1 }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Main application thread. 

This manages the flow of ICALL and RTOS messages. It also manages the periodic clock and can be used to poll sensors that do not have their own RTOS task TODO USER CODE 8\+: If you are not using a task for your sensor, poll it here